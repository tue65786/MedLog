<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
	<head>
		<title>TODO supply a title</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://code.jquery.com/jquery-3.1.1.min.js" type="text/javascript"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20160511/json2.js" type="text/javascript"></script>
	</head>
	<body>
		<form method="post" name="loginForm" id="loginForm" autocomplete="on">

			<fieldset>
				<legend>Login Credentials</legend>
				<label for="username">Username [SET TO dan]:<br></label>
				<input name="username" type="text" id="username" placeholder="" required><br>
				<label for="password"> Password [SET TO asdf]:<br></label>
				<input name="password" type="password" id="password" placeholder="" required><br>
			</fieldset>
			<input type="submit" value="LOGIN" id="btnSubmit"/>
			<div id="message" ></div>

		</form>
		<!--Logged in View-->
		<fieldset id="myinfo" style="display:none;"><legend id="loggedinMsg">Welcome back!</legend>
			<form id="userInfos">
				<label for="firstname">First name:<br></label>
				<input name="firstname" type="text" readonly id="firstname" placeholder="Enter your first name" required/>
				<br>
				<label for="lastname">Last name:<br></label>
				<input name="lastname" type="text" readonly id="lastname" placeholder="Enter your last name" required/><br/>
				<label>Street</label><input type="text" readonly id="street"/>
				State<br>
				<select id="state">
					<option checked value="0">State....</option>
					<option value="2">Pennsylvania</option></select>
				<br/>
				<label>Data Returned from AJAX:</label>
				<br>
				<textarea id="jsraw" rows="5" cols="40" style="width:300px;height:200px;"></textarea><br/>
				<input type="button" value="Logout" id="btnLogout"/>
			</form>
		</fieldset>
		<script>
			 $(document).ready(function () {
				 
				//Triggered when submit button is clicked!
				//////////////////////////////////////////////
				$("#loginForm").on("submit", function ( event ) {
					 event.preventDefault();
					 var username = $("#username").val();
					 var password = $("#password").val();

					 var theURL = "./api/?fn=login&username=" + username + "&password=" + password;
					 // 
					 // MAKE AJAX CALL!!
					 /////////
					 $.post(theURL)
						 .done(function ( data ) {
							 if ( typeof data !== 'undefined' ) {
								 if ( typeof data.message !== 'undefined' ) {
									 $("#message").empty().html("<b style='color:red'>" + data.message + "</b>");
								 } else {
									 //No errors! --- show Logged in Version
									 $("#loginForm").hide();
									 $("#myinfo").slideDown();
									 //Set form fields from AJAX response stored in 'data' variable.
									 $("#firstname").val(data.firstName);
									 $("#street").val(data.addressStreet);
									 $("#lastname").val(data.lastName);
									 $("#state").val(data.addressState.stateID);
									 $("#jsraw").val(JSON.stringify(data));
								 }
							 } else {
								 $("#message").empty().
									 html("<b style='color:red'>" + "No response.. is server running? " + "</b>");
								 console.log("data undefined");
							 }
						 })
						 .fail(function ( xhr, error, status ) {//IF AJAX CALL FAILS!
							 $("#message").empty().html("<b style='color:red'>AJAX failed:" + error + "</b>");
						 });
				 });
				//Handle click event when logout is pressed
				 $("#btnLogout").on("click", function ( e ) {
					 e.preventDefault();
					 $("#username").val("");
					 $("#password").val("");
					 $("#myinfo").slideUp('fast');
					 $("#loginForm").fadeIn('slow');
				 });
			 });
		</script>					
	</body>
</html>
